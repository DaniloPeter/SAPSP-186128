<mvc:View
    controllerName="com.segezha.form.roll.conversion.controller.Home"
    xmlns:customControls="com.segezha.form.roll.conversion.customControls"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    displayBlock="true">
    <Page id="homePageId">
        <customHeader>
            <Toolbar>
                <ToolbarSpacer />
                <Title text="Опросный лист" />
                <ToolbarSpacer />
            </Toolbar>
        </customHeader>
        <content>
            <VBox class="sapUiSmallMargin">
                <VBox class="sapUiSmallMarginBottom sapUiFormResGrid sapUiFormBackgrTranslucent">
                    <HBox>
                        <VBox width="100%" class="sapUiSmallMarginEnd">
                            <Label text="Завод:" required="true" />
                            <Input
                                enabled="false"
                                width="100%"
                                value="{Werks}"
                                valueState="{=!!${state>/errorFields/Werks} ? 'Error' : 'None'}"
                                change="onChangeCommonField">
                            </Input>
                        </VBox>
                        <VBox width="100%" class="sapUiSmallMarginEnd">
                            <Label text="Ресурс:" required="true" />
                            <Input
                                maxLength="12"
                                width="100%"
                                showSuggestion="true"
                                maxSuggestionWidth="60rem"
                                value="{WpResource}"
                                valueState="{=!!${state>/errorFields/WpResource} ? 'Error' : 'None'}"
                                suggestionRows="{
                                    path: '/WORKPLACESet'
                                }"
                                change="onChangeWpResource">
                                <suggestionColumns>
                                    <Column>
                                        <Text text="{/#WORKPLACE/WpResource/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#WORKPLACE/WpResourceText/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#WORKPLACE/WpParameter/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#WORKPLACE/Werks/@sap:label}" />
                                    </Column>
                                </suggestionColumns>
                                <suggestionRows>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{WpResource}" />
                                            <Text text="{WpResourceText}" />
                                            <Text text="{WpParameter}" />
                                            <Text text="{Werks}" />
                                        </cells>
                                    </ColumnListItem>
                                </suggestionRows>
                            </Input>
                        </VBox>
                        <VBox width="100%" class="sapUiSmallMarginEnd">
                            <Label text="Склад:" required="true" />
                            <Input
                                width="100%"
                                showSuggestion="true"
                                maxSuggestionWidth="60rem"
                                value="{Lgort}"
                                valueState="{=!!${state>/errorFields/Lgort} ? 'Error' : 'None'}"
                                suggestionRows="{
                                    path: '/LGORTSet'
                                }"
                                change="onChangeLgort">
                                <suggestionColumns>
                                    <Column>
                                        <Text text="{/#LGORT/Lgort/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#LGORT/Lgobe/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#LGORT/Werks/@sap:label}" />
                                    </Column>
                                </suggestionColumns>
                                <suggestionRows>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{Lgort}" />
                                            <Text text="{Lgobe}" />
                                            <Text text="{Werks}" />
                                        </cells>
                                    </ColumnListItem>
                                </suggestionRows>
                            </Input>
                        </VBox>
                        <VBox width="100%">
                            <Label text="Режим флексопечати:" />
                            <Select
                                width="100%"
                                forceSelection="false"
                                showSecondaryValues="true"
                                selectedKey="{WpOperatingmode}"
                                items="{/OPERATINGMODESet}">
                                <core:ListItem key="{WpOperatingmode}" text="{WpOperatingmode}"
                                    additionalText="{Text}" />
                            </Select>
                        </VBox>
                    </HBox>
                    <HBox>
                        <VBox width="100%" class="sapUiSmallMarginEnd">
                            <Label text="Дата и время:" required="true" />
                            <DateTimePicker
                                enabled="false"
                                dateValue="{Zdatetime}"
                                valueState="{=!!${state>/errorFields/Zdatetime} ? 'Error' : 'None'}"
                                width="100%"
                                displayFormat="dd.MM.yyyy HH:mm:ss"
                            />
                        </VBox>
                        <VBox width="100%" class="sapUiSmallMarginEnd">
                            <Label text="Смена:" />
                            <Input
                                width="100%"
                                showSuggestion="true"
                                maxSuggestionWidth="60rem"
                                value="{Smen}"
                                valueState="{=!!${state>/errorFields/Smen} ? 'Error' : 'None'}"
                                suggestionRows="{
                                    path: '/SMENSet'
                                }"
                                change="onChangeCommonField">
                                <suggestionColumns>
                                    <Column>
                                        <Text text="{/#SMEN/Smen/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#SMEN/Period/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#SMEN/Werks/@sap:label}" />
                                    </Column>
                                </suggestionColumns>
                                <suggestionRows>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{Smen}" />
                                            <Text text="{Period}" />
                                            <Text text="{Werks}" />
                                        </cells>
                                    </ColumnListItem>
                                </suggestionRows>
                            </Input>
                        </VBox>
                        <VBox width="100%">
                            <Label text="Бригада:" />
                            <Input
                                width="100%"
                                showSuggestion="true"
                                maxSuggestionWidth="60rem"
                                value="{Brig}"
                                valueState="{=!!${state>/errorFields/Brig} ? 'Error' : 'None'}"
                                suggestionRows="{
                                    path: '/BRIGSet'
                                }"
                                change="onChangeCommonField">
                                <suggestionColumns>
                                    <Column>
                                        <Text text="{/#BRIG/Brig/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#BRIG/BrigName/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#BRIG/Werks/@sap:label}" />
                                    </Column>
                                </suggestionColumns>
                                <suggestionRows>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{Brig}" />
                                            <Text text="{BrigName}" />
                                            <Text text="{Werks}" />
                                        </cells>
                                    </ColumnListItem>
                                </suggestionRows>
                            </Input>
                        </VBox>
                    </HBox>
                </VBox>
                <HBox class="sapUiSmallMarginBottom">
                    <VBox
                        class="sapUiFormResGrid sapUiFormBackgrTranslucent sapUiSmallMarginEnd"
                        width="100%">
                        <Title text="Заказ" />
                        <VBox>
                            <Label text="Заказ" required="true" />
                            <MaskInput width="100%" mask="AA00000AAAAA" placeholderSymbol="_"
                                value="{Aufnr}"
                                valueState="{=!!${state>/errorFields/Aufnr} ? 'Error' : 'None'}"
                                change="onChangeAufnr"
                                placeholder="Номер технологического заказа"
                            >
                                <rules>
                                    <MaskInputRule maskFormatSymbol="A" regex="[0-9]" />
                                </rules>
                            </MaskInput>
                        </VBox>
                        <VBox>
                            <Label text="Клише" required="true" />
                            <Input maxLength="40"
                                enabled="false"
                                value="{Klishe}"
                                change="onChangeCommonField"
                                valueState="{=!!${state>/errorFields/Klishe} ? 'Error' : 'None'}"
                                placeholder="Клише"
                            />
                        </VBox>
                        <VBox>
                            <Label text="Описание клише" />
                            <Input maxLength="40"
                                value="{Zklishetext}" placeholder="Описание клише" />
                        </VBox>
                        <VBox>
                            <Label text="Скорость машины" />
                            <customControls:NumberInput numericValue="{Zobjspeed}"
                                valueState="{=!!${state>/errorFields/Zobjspeed} ? 'Error' : 'None'}"
                                change="onChangeCommonField"
                                placeholder="Скорость машины" />
                        </VBox>
                        <VBox>
                            <Label text="Печатник высокой печати" required="true" />
                            <Input value="{Zprinter}"
                                valueState="{=!!${state>/errorFields/Zprinter} ? 'Error' : 'None'}"
                                maxLength="150"
                                change="onChangeCommonField"
                                placeholder="ФИО печатника" />
                        </VBox>
                        <VBox>
                            <Label text="Инженер по качеству" />
                            <Input
                                change="onChangeCommonField"
                                width="100%"
                                showSuggestion="true"
                                maxSuggestionWidth="60rem"
                                value="{Zlogin}"
                                valueState="{=!!${state>/errorFields/Zlogin} ? 'Error' : 'None'}"
                                suggestionRows="{
                                    path: '/QASet'
                                }">
                                <suggestionColumns>
                                    <Column>
                                        <Text text="{/#QA/Zlogin/@sap:label}" />
                                    </Column>
                                    <Column>
                                        <Text text="{/#QA/Zfullnameqa/@sap:label}" />
                                    </Column>
                                </suggestionColumns>
                                <suggestionRows>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{Zlogin}" />
                                            <Text text="{Zfullnameqa}" />
                                        </cells>
                                    </ColumnListItem>
                                </suggestionRows>
                            </Input>
                        </VBox>
                    </VBox>
                    <VBox class="sapUiFormResGrid sapUiFormBackgrTranslucent" width="100%">
                        <Title text="Рулон" />
                        <VBox>
                            <Label
                                text="№ Рулона 1 {parts: [{ path: 'state>/rollData/roll1/Material'}],
                                            formatter: '.formatter.formatLabelWithBrackets' }"
                                required="true" />
                            <Input maxLength="30" required="true" value="{RollNum1}"
                                valueState="{=!!${state>/errorFields/RollNum1} ? 'Error' : 'None'}"
                                change="onChangeRollNum"
                                placeholder="Номер рулона 1" />
                        </VBox>
                        <VBox>
                            <Label
                                text="Формат исходного рулона 1  {parts: [{ path: 'state>/rollData/roll1/Charg'}],
                                            formatter: '.formatter.formatLabelWithBrackets' }"
                                required="true" />
                            <customControls:NumberInput enabled="false" required="true"
                                numericValue="{Zformat1}"
                                valueState="{=!!${state>/errorFields/Zformat1} ? 'Error' : 'None'}"
                                change="onChangeCommonField"
                                placeholder="Формат исходного рулона 1" />
                        </VBox>
                        <VBox>
                            <Label text="Радиус остатка 1" required="true" />
                            <customControls:NumberInput required="true" numericValue="{Zradius1}"
                                valueState="{=!!${state>/errorFields/Zradius1} ? 'Error' : 'None'}"
                                change="onChangeCommonField"
                                placeholder="Радиус остатка 1" />

                        </VBox>
                        <VBox>
                            <Label
                                text="№ Рулона 2 {parts: [{ path: 'state>/rollData/roll2/Material'}],
                                            formatter: '.formatter.formatLabelWithBrackets' }" />
                            <Input maxLength="30" value="{RollNum2}"
                                valueState="{=!!${state>/errorFields/RollNum2} ? 'Error' : 'None'}"
                                change="onChangeRollNum"
                                placeholder="Номер рулона 2" />
                        </VBox>
                        <VBox>
                            <Label
                                text="Формат исходного рулона 2  {parts: [{ path: 'state>/rollData/roll2/Charg'}],
                                            formatter: '.formatter.formatLabelWithBrackets' }" />
                            <customControls:NumberInput enabled="false" numericValue="{Zformat2}"
                                valueState="{=!!${state>/errorFields/Zformat2} ? 'Error' : 'None'}"
                                placeholder="Формат исходного рулона 2" />
                        </VBox>
                        <VBox>
                            <Label text="Радиус остатка 2" />
                            <customControls:NumberInput numericValue="{Zradius2}"
                                valueState="{=!!${state>/errorFields/Zradius2} ? 'Error' : 'None'}"
                                change="onChangeCommonField"
                                placeholder="Радиус остатка 2" />
                        </VBox>
                    </VBox>
                </HBox>
                <VBox class="sapUiFormResGrid sapUiFormBackgrTranslucent sapUiSmallMarginBottom">
                    <HBox width="100%">
                        <VBox width="100%" class="sapUiSmallMarginEnd">
                            <Label text="Формат запечатанного рулона" required="true" />
                            <customControls:NumberInput required="true" numericValue="{Znewformat}"
                                valueState="{=!!${state>/errorFields/Znewformat} ? 'Error' : 'None'}"
                                change="onChangeZnewformat"
                                placeholder="Формат запечатанного рулона" />

                        </VBox>
                        <VBox width="100%" class="sapUiSmallMarginEnd">
                            <Label text="Погонные метры" required="true" />
                            <customControls:NumberInput required="true" numericValue="{Zpm}"
                                valueState="{=!!${state>/errorFields/Zpm} ? 'Error' : 'None'}"
                                change="onChangeMetersOrReport"
                                placeholder="Метраж выходящего погонного рулона" />
                        </VBox>
                        <VBox width="100%">
                            <Label text="Длина рапорта" required="true" />
                            <customControls:NumberInput required="true"
                                numericValue="{Zlengthreport}"
                                valueState="{=!!${state>/errorFields/Zlengthreport} ? 'Error' : 'None'}"
                                change="onChangeMetersOrReport"
                                placeholder="Длина рапорта" />
                        </VBox>
                    </HBox>
                    <HBox width="100%">
                        <VBox width="100%" class="sapUiSmallMarginEnd">
                            <Label text="Оттиски" required="true" />
                            <customControls:NumberInput enabled="false" required="true"
                                numericValue="{Zstamp}"
                                valueState="{=!!${state>/errorFields/Zstamp} ? 'Error' : 'None'}"
                                change="onChangeCommonField"
                                placeholder="Оттиски" />
                        </VBox>
                        <VBox width="100%" class="sapUiSmallMarginEnd">
                            <Label text="Диаметр запечатанного рулона" required="true" />
                            <customControls:NumberInput required="true"
                                numericValue="{Zflexdiameter}"
                                valueState="{=!!${state>/errorFields/Zflexdiameter} ? 'Error' : 'None'}"
                                change="onChangeCommonField"
                                placeholder="Диаметр запечатанного рулона" />

                        </VBox>
                        <VBox width="100%">
                            <Label text="Вес срыва:" />
                            <customControls:NumberInput numericValue="{Zwaste}"
                                valueState="{=!!${state>/errorFields/Zwaste} ? 'Error' : 'None'}"
                                change="onChangeCommonField"
                                liveChange="onChangeZwaste"
                                placeholder="Вес срыва" />

                            <Text
                                text="При срыве более 50 кг необходимо заполнить поля Брак" />
                        </VBox>
                    </HBox>
                </VBox>

                <VBox class="sapUiTinyMarginBottom sapUiFormResGrid sapUiFormBackgrTranslucent">
                    <Table items="{state>/tables/defect/items}"
                        mode="MultiSelect">
                        <headerToolbar>
                            <OverflowToolbar>
                                <content>
                                    <Title text="Брак" level="H2" />
                                    <Switch id="defectSwitch"
                                        change="onSwitch($event, 'defect')"
                                        state="{state>/switches/defect}"
                                        enabled="{ parts: [{ path: 'Zwaste'}],
                                            formatter: '.formatter.formatSwitchDefectEnabled' }"
                                        customTextOn=" " customTextOff=" " />
                                    <ToolbarSpacer />
                                    <Button
                                        icon="sap-icon://delete" text="Удалить дефект"
                                        enabled="{state>/switches/defect}"
                                        press="onRemoveRow($event, 'defect')" />
                                    <Button icon="sap-icon://add" text="Добавить брак"
                                        enabled="{state>/switches/defect}"
                                        press="onAddRow($event, 'defect')" />
                                </content>
                            </OverflowToolbar>
                        </headerToolbar>
                        <columns>
                            <Column>
                                <Label required="true" text="Объект брака" />
                            </Column>
                            <Column>
                                <Label required="true" text="Вид брака" />
                            </Column>
                        </columns>
                        <items>
                            <ColumnListItem>
                                <Select change="onChangeCommonField"
                                    width="100%"
                                    enabled="{state>/switches/defect}"
                                    valueState="{=!!${state>Zobjdefect_error} ? 'Error' : 'None'}"
                                    forceSelection="false"
                                    showSecondaryValues="true"
                                    selectedKey="{state>Zobjdefect}"
                                    items="{
                                        path: '/OBJDEFECTSet',
                                        templateShareable: false
                                    }">
                                    <core:Item key="{Zobjdefect}" text="{Zobjdefect}" />
                                </Select>

                                <Input required="true"
                                    value="{state>Zcommentdefect}"
                                    valueState="{=!!${state>Zcommentdefect_error} ? 'Error' : 'None'}"
                                    placeholder="Комментарий, содержащий информацию о браке рулона"
                                    change="onChangeCommonField"
                                    enabled="{state>/switches/defect}" />
                            </ColumnListItem>
                        </items>
                    </Table>
                </VBox>
                <VBox class="sapUiTinyMarginBottom sapUiFormResGrid sapUiFormBackgrTranslucent">
                    <Table items="{state>/tables/downTime/items}"
                        mode="MultiSelect">
                        <headerToolbar>
                            <OverflowToolbar>
                                <content>
                                    <Title text="Простой" level="H2" />
                                    <Switch
                                        change="onSwitch($event, 'downTime')"
                                        state="{state>/switches/downTime}"
                                        customTextOn=" "
                                        customTextOff=" "
                                    />
                                    <ToolbarSpacer />
                                    <Button
                                        icon="sap-icon://delete" text="Удалить простой"
                                        enabled="{state>/switches/downTime}"
                                        press="onRemoveRow($event, 'downTime')" />
                                    <Button
                                        icon="sap-icon://add" text="Добавить простой"
                                        enabled="{state>/switches/downTime}"
                                        press="onAddRow($event, 'downTime')" />
                                </content>
                            </OverflowToolbar>
                        </headerToolbar>
                        <columns>
                            <Column>
                                <Label required="true" text="Тип простоя" />
                            </Column>
                            <Column>
                                <Label required="true" text="Начало простоя" />
                            </Column>

                            <Column>
                                <Label required="true" text="Конец простоя" />
                            </Column>
                            <Column>
                                <Label required="true" text="Время простоя, часов, минут" />
                            </Column>
                            <Column>
                                <Label required="true" text="Причина простоя" />
                            </Column>
                        </columns>
                        <items>
                            <ColumnListItem>
                                <Input required="true"
                                    valueHelpOnly="true"
                                    enabled="{state>/switches/downTime}"
                                    value="{state>Kurztext}"
                                    valueState="{=!!${state>Kurztext_error} ? 'Error' : 'None'}"
                                    showValueHelp="true"
                                    showSuggestion="true"
                                    maxSuggestionWidth="60rem"
                                    valueHelpRequest=".onVHDownTimeRequested"
                                    suggestionRows="{
                                        path: '/QMSet',
                                        templateShareable: false
                                    }">
                                    <suggestionColumns>
                                        <Column>
                                            <Text text="{/#QM/Kurztext/@sap:label}" />
                                        </Column>
                                        <Column>
                                            <Text text="{/#QM/Kurztext2/@sap:label}" />
                                        </Column>
                                        <Column>
                                            <Text text="{/#QM/Rbnr/@sap:label}" />
                                        </Column>
                                        <Column>
                                            <Text text="{/#QM/Qmgrp/@sap:label}" />
                                        </Column>
                                        <Column>
                                            <Text text="{/#QM/Qmcod/@sap:label}" />
                                        </Column>
                                    </suggestionColumns>
                                    <suggestionRows>
                                        <ColumnListItem>
                                            <cells>
                                                <Text text="{Kurztext}" />
                                                <Text text="{Kurztext2}" />
                                                <Text text="{Rbnr}" />
                                                <Text text="{Qmgrp}" />
                                                <Text text="{Qmcod}" />
                                            </cells>
                                        </ColumnListItem>
                                    </suggestionRows>
                                </Input>
                                <TimePicker required="true"
                                    enabled="{= ${state>/switches/downTime}}"
                                    valueState="{=!!${state>Auztv_error} ? 'Error' : 'None'}"
                                    dateValue="{state>Auztv}"
                                    change="onChangeDownTime"
                                    displayFormat="HH:mm"
                                    valueFormat="HH:mm"
                                    placeholder="--:--"
                                />
                                <TimePicker required="true"
                                    enabled="{= ${state>/switches/downTime}}"
                                    valueState="{=!!${state>Auztb_error} ? 'Error' : 'None'}"
                                    dateValue="{state>Auztb}"
                                    valueFormat="HH:mm"
                                    displayFormat="HH:mm"
                                    change="onChangeDownTime"
                                    placeholder="--:--" />

                                <TimePicker required="true"
                                    enabled="{= ${state>/switches/downTime}}"
                                    value="{
                                        'path':'state>Zdownhours',
                                        'type': 'sap.ui.model.type.Time',
                                        'formatOptions': {
                                                'pattern': 'HH:mm'
                                        }
                                    }"
                                    valueState="{=!!${state>Zdownhours_error} ? 'Error' : 'None'}"
                                    valueStateText="{=!!${state>Zdownhours_error} ? 'Введите время начала простоя, не превышающее время окончания' : ''}"
                                    displayFormat="HH:mm"
                                    valueFormat="HH:mm"
                                    placeholder="--:--"
                                />
                                <Input required="true"
                                    value="{state>Qmtxt}"
                                    valueState="{=!!${state>Qmtxt_error} ? 'Error' : 'None'}"
                                    change="onChangeCommonField"
                                    enabled="{state>/switches/downTime}" />
                            </ColumnListItem>
                        </items>
                    </Table>
                </VBox>
            </VBox>
        </content>
        <footer>
            <Toolbar>
                <ToolbarSpacer />
                <Button
                    type="Emphasized"
                    text="Подтвердить"
                    press="onConfirmFormData" />
            </Toolbar>
        </footer>
    </Page>
</mvc:View>